# ğŸ“Š è®ºæ–‡å›¾è¡¨ç”ŸæˆæŒ‡å—

æœ¬æŒ‡å—ä»‹ç»å¦‚ä½•ä½¿ç”¨æä¾›çš„è„šæœ¬ç”Ÿæˆè®ºæ–‡æ‰€éœ€çš„å„ç±»å›¾è¡¨ã€‚

## ğŸ“ å¯è§†åŒ–è„šæœ¬æ¦‚è§ˆ

| è„šæœ¬åç§° | åŠŸèƒ½ | è¾“å…¥ | è¾“å‡º |
|---------|------|------|------|
| `plot_training_curves.py` | è®­ç»ƒå†å²æ›²çº¿ | `history_*.json` | Lossã€MAE/Accuracyæ›²çº¿ |
| `plot_predictions.py` | é¢„æµ‹ç»“æœå›¾ | `predictions_*.csv` | æ•£ç‚¹å›¾ã€æ®‹å·®å›¾ã€æ··æ·†çŸ©é˜µ |
| `visualize_latent_space.py` | æ½œåœ¨ç©ºé—´å¯è§†åŒ– | checkpoint + data loader | t-SNE/UMAPé™ç»´å›¾ |
| `visualize_latent_from_output.py` | ä¾¿æ·ç‰ˆæ½œåœ¨ç©ºé—´å¯è§†åŒ– | checkpoint + æ•°æ®é›†ä¿¡æ¯ | t-SNE/UMAPé™ç»´å›¾ |
| `generate_all_figures.sh` | ä¸€é”®ç”Ÿæˆæ‰€æœ‰å›¾è¡¨ | è¾“å‡ºç›®å½• | æ‰€æœ‰å›¾è¡¨ |

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ä¸€é”®ç”ŸæˆåŸºç¡€å›¾è¡¨

æœ€ç®€å•çš„æ–¹å¼æ˜¯ä½¿ç”¨ä¸€é”®è„šæœ¬ï¼š

```bash
# åŸºæœ¬ç”¨æ³•
./generate_all_figures.sh ./output_class_syn

# æŒ‡å®šä¿å­˜ç›®å½•
./generate_all_figures.sh ./output_class_syn ./paper_figures
```

è¿™ä¼šç”Ÿæˆï¼š
- âœ… è®­ç»ƒLossæ›²çº¿
- âœ… ä¸»è¦æŒ‡æ ‡æ›²çº¿ï¼ˆMAEæˆ–Accuracyï¼‰
- âœ… é¢„æµ‹vsçœŸå®å€¼æ•£ç‚¹å›¾
- âœ… æ®‹å·®å›¾ï¼ˆå›å½’ï¼‰æˆ–æ··æ·†çŸ©é˜µï¼ˆåˆ†ç±»ï¼‰

---

## ğŸ“ˆ è¯¦ç»†ä½¿ç”¨è¯´æ˜

### 1. è®­ç»ƒå†å²æ›²çº¿

**ç”Ÿæˆè®­ç»ƒè¿‡ç¨‹ä¸­çš„Losså’ŒæŒ‡æ ‡å˜åŒ–æ›²çº¿**

```bash
python plot_training_curves.py \
    --output_dir ./output_class_syn \
    --save_dir ./figures \
    --no_show  # ä¸æ˜¾ç¤ºå›¾ç‰‡ï¼Œä»…ä¿å­˜
```

**ç”Ÿæˆçš„å›¾ç‰‡ï¼š**
- `training_loss_curve.pdf/png` - Lossæ›²çº¿
- `training_mae_curve.pdf/png` æˆ– `training_accuracy_curve.pdf/png` - ä¸»è¦æŒ‡æ ‡æ›²çº¿
- `training_classification_metrics.pdf/png` - åˆ†ç±»ä»»åŠ¡çš„Precision/Recallæ›²çº¿ï¼ˆå¦‚æœæ˜¯åˆ†ç±»ï¼‰
- `training_curves_combined.pdf/png` - ç»¼åˆå¯¹æ¯”å›¾

**ç¤ºä¾‹è¾“å‡ºï¼š**
```
âœ… ä¿å­˜Lossæ›²çº¿: ./figures/training_loss_curve.pdf
âœ… ä¿å­˜Accuracyæ›²çº¿: ./figures/training_accuracy_curve.pdf
âœ… ä¿å­˜ç»¼åˆæ›²çº¿: ./figures/training_curves_combined.pdf

ğŸ“Š è®­ç»ƒç»Ÿè®¡ä¿¡æ¯
===============================================================
æ€»è®­ç»ƒè½®æ¬¡: 100
æœ€ç»ˆè®­ç»ƒLoss: 0.234567
æœ€ç»ˆéªŒè¯Loss: 0.345678
æœ€å°éªŒè¯Loss: 0.321234 (Epoch 78)

æœ€ç»ˆéªŒè¯Accuracy: 0.9200
æœ€ä½³éªŒè¯Accuracy: 0.9350 (Epoch 78)
===============================================================
```

---

### 2. é¢„æµ‹ç»“æœå¯è§†åŒ–

**ç”Ÿæˆé¢„æµ‹å€¼vsçœŸå®å€¼çš„å¯¹æ¯”å›¾**

```bash
python plot_predictions.py \
    --output_dir ./output_class_syn \
    --save_dir ./figures \
    --no_show
```

**å›å½’ä»»åŠ¡ç”Ÿæˆï¼š**
- `predictions_separate.pdf/png` - è®­ç»ƒ/éªŒè¯/æµ‹è¯•é›†åˆ†å¼€çš„æ•£ç‚¹å›¾
- `predictions_combined.pdf/png` - åˆå¹¶çš„æ•£ç‚¹å›¾
- `predictions_residuals.pdf/png` - æ®‹å·®å›¾

**åˆ†ç±»ä»»åŠ¡ç”Ÿæˆï¼š**
- `predictions_confusion_matrix.pdf/png` - æ··æ·†çŸ©é˜µ
- `predictions_probability_distribution.pdf/png` - é¢„æµ‹æ¦‚ç‡åˆ†å¸ƒ
- `predictions_roc_curve.pdf/png` - ROCæ›²çº¿

**ç¤ºä¾‹è¾“å‡ºï¼š**
```
âœ… æ‰¾åˆ°testé›†é¢„æµ‹æ–‡ä»¶
âœ… ä¿å­˜åˆ†å¼€çš„é¢„æµ‹å›¾: ./figures/predictions_separate.pdf
âœ… ä¿å­˜åˆå¹¶çš„é¢„æµ‹å›¾: ./figures/predictions_combined.pdf

ğŸ“Š å›å½’é¢„æµ‹ç»Ÿè®¡ä¿¡æ¯
======================================================================
TEST SET:
  æ ·æœ¬æ•°: 1250
  MAE:    0.195432
  RMSE:   0.287654
  RÂ²:     0.923456
======================================================================
```

---

### 3. æ½œåœ¨ç©ºé—´å¯è§†åŒ–

**å±•ç¤ºæ¨¡å‹å­¦ä¹ åˆ°çš„ç‰¹å¾è¡¨ç¤ºè´¨é‡**

#### æ–¹æ³•1: ä»ä¿å­˜çš„data loaderï¼ˆå¿«é€Ÿï¼‰

å¦‚æœè®­ç»ƒæ—¶è®¾ç½®äº† `--save_dataloader`ï¼š

```bash
python visualize_latent_space.py \
    --checkpoint ./output_class_syn/best_val_model.pt \
    --data_loader_path ./output_class_syn/data_loader_test.pt \
    --save_dir ./figures/latent_space \
    --device cuda \
    --feature_types graph text fused \
    --methods tsne umap \
    --dimensions 2 3 \
    --classification  # å¦‚æœæ˜¯åˆ†ç±»ä»»åŠ¡æ·»åŠ æ­¤å‚æ•°
```

#### æ–¹æ³•2: ä»è®­ç»ƒé…ç½®é‡å»ºï¼ˆæ¨èï¼Œæ›´çµæ´»ï¼‰

```bash
python visualize_latent_from_output.py \
    --output_dir ./output_class_syn \
    --dataset class \
    --property syn \
    --root_dir ./dataset \
    --split test \
    --checkpoint best_val_model.pt \
    --save_dir ./figures/latent_space \
    --device cuda \
    --feature_types graph text fused \
    --methods tsne \
    --dimensions 2 \
    --max_samples 1000  # å¤§æ•°æ®é›†å¯é™åˆ¶æ ·æœ¬æ•°åŠ é€Ÿ
```

**å‚æ•°è¯´æ˜ï¼š**
- `--feature_types`: é€‰æ‹©è¦å¯è§†åŒ–çš„ç‰¹å¾
  - `graph`: ä»…å›¾ç‰¹å¾
  - `text`: ä»…æ–‡æœ¬ç‰¹å¾
  - `fused`: èåˆç‰¹å¾ï¼ˆå›¾+æ–‡æœ¬ï¼‰
- `--methods`: é™ç»´æ–¹æ³•
  - `tsne`: t-SNEï¼ˆé»˜è®¤ï¼Œæ— éœ€é¢å¤–å®‰è£…ï¼‰
  - `umap`: UMAPï¼ˆéœ€è¦ `pip install umap-learn`ï¼‰
- `--dimensions`: é™ç»´ç»´åº¦
  - `2`: 2Då¯è§†åŒ–ï¼ˆå¿«é€Ÿï¼‰
  - `3`: 3Då¯è§†åŒ–ï¼ˆæ›´ç›´è§‚ä½†è¾ƒæ…¢ï¼‰
- `--split`: ä½¿ç”¨å“ªä¸ªæ•°æ®é›†
  - `train`: è®­ç»ƒé›†
  - `val`: éªŒè¯é›†
  - `test`: æµ‹è¯•é›†ï¼ˆæ¨èï¼‰
- `--max_samples`: é™åˆ¶æ ·æœ¬æ•°ï¼ˆæ¨èâ‰¤2000ï¼ŒåŠ é€Ÿå¯è§†åŒ–ï¼‰

**ç”Ÿæˆçš„å›¾ç‰‡ï¼š**
- `latent_space_graph_tsne_2d.pdf` - å›¾ç‰¹å¾çš„2D t-SNE
- `latent_space_text_tsne_2d.pdf` - æ–‡æœ¬ç‰¹å¾çš„2D t-SNE
- `latent_space_fused_tsne_2d.pdf` - èåˆç‰¹å¾çš„2D t-SNE
- `latent_space_comparison_tsne_2d.pdf` - ä¸‰ç§ç‰¹å¾çš„å¯¹æ¯”å›¾ï¼ˆ**è®ºæ–‡æ¨è**ï¼‰
- `latent_space_*_3d.pdf` - 3Dç‰ˆæœ¬

**ç¤ºä¾‹è¾“å‡ºï¼š**
```
ğŸ¨ æ½œåœ¨ç©ºé—´å¯è§†åŒ–
======================================================================
ğŸ”„ æ­£åœ¨æå–ç‰¹å¾: ['graph', 'text', 'fused']
æå–ç‰¹å¾: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 32/32 [00:15<00:00,  2.13it/s]
âœ… ç‰¹å¾æå–å®Œæˆ
   graph: (1000, 64)
   text: (1000, 768)
   fused: (1000, 832)
   targets: (1000,)

======================================================================
ğŸ“Š ä½¿ç”¨ TSNE è¿›è¡Œé™ç»´
======================================================================
ğŸ”„ åº”ç”¨TSNEé™ç»´åˆ°2D...
âœ… é™ç»´å®Œæˆ: (1000, 2)
âœ… ä¿å­˜2Då›¾: ./figures/latent_space_graph_tsne_2d.pdf
âœ… ä¿å­˜å¯¹æ¯”å›¾: ./figures/latent_space_comparison_tsne_2d.pdf
======================================================================
```

---

## ğŸ¨ å›¾è¡¨è¯´æ˜ä¸è®ºæ–‡ç”¨é€”

### 1. è®­ç»ƒæ›²çº¿ (Training Curves)

**ç”¨é€”ï¼š**
- å±•ç¤ºæ¨¡å‹æ”¶æ•›è¿‡ç¨‹
- éªŒè¯æ²¡æœ‰è¿‡æ‹Ÿåˆ
- å¯¹æ¯”ä¸åŒé…ç½®çš„è®­ç»ƒæ•ˆæœ

**è®ºæ–‡ä½ç½®ï¼š**
- ä¸»æ–‡ä¸­ï¼šå±•ç¤ºæœ€ä½³æ¨¡å‹çš„è®­ç»ƒè¿‡ç¨‹
- è¡¥å……ææ–™ï¼šå±•ç¤ºä¸åŒè¶…å‚æ•°çš„è®­ç»ƒæ›²çº¿å¯¹æ¯”

**è§£è¯»è¦ç‚¹ï¼š**
- âœ… éªŒè¯Lossé€æ¸ä¸‹é™ â†’ æ¨¡å‹æ­£å¸¸å­¦ä¹ 
- âœ… è®­ç»ƒLossä¸éªŒè¯Losså·®è·å° â†’ æ²¡æœ‰ä¸¥é‡è¿‡æ‹Ÿåˆ
- âœ… æ—©åœç‚¹åœ¨åˆç†ä½ç½® â†’ é¿å…äº†è¿‡æ‹Ÿåˆ

---

### 2. é¢„æµ‹ç»“æœå›¾ (Prediction Plots)

#### å›å½’ä»»åŠ¡æ•£ç‚¹å›¾
**ç”¨é€”ï¼š**
- ç›´è§‚å±•ç¤ºé¢„æµ‹å‡†ç¡®æ€§
- é€šè¿‡å¯¹è§’çº¿è·ç¦»åˆ¤æ–­è¯¯å·®
- RÂ²å’ŒMAEé‡åŒ–æ€§èƒ½

**è®ºæ–‡ä½ç½®ï¼š**
- ä¸»æ–‡ä¸­ï¼šå±•ç¤ºæµ‹è¯•é›†ç»“æœ
- å¯¹æ¯”å›¾ï¼šä¸baselineæ–¹æ³•å¯¹æ¯”

**è§£è¯»è¦ç‚¹ï¼š**
- âœ… ç‚¹è¶Šæ¥è¿‘å¯¹è§’çº¿ â†’ é¢„æµ‹è¶Šå‡†ç¡®
- âœ… RÂ² > 0.9 â†’ å¾ˆå¥½çš„æ‹Ÿåˆ
- âœ… MAEè¶Šå°è¶Šå¥½

#### åˆ†ç±»ä»»åŠ¡æ··æ·†çŸ©é˜µ
**ç”¨é€”ï¼š**
- å±•ç¤ºåˆ†ç±»å‡†ç¡®æ€§
- è¯†åˆ«å“ªç±»å®¹æ˜“è¯¯åˆ†ç±»

**è§£è¯»è¦ç‚¹ï¼š**
- âœ… å¯¹è§’çº¿æ•°å€¼å¤§ â†’ åˆ†ç±»å‡†ç¡®
- âš ï¸ éå¯¹è§’çº¿æ•°å€¼å¤§ â†’ å­˜åœ¨è¯¯åˆ†ç±»

---

### 3. æ½œåœ¨ç©ºé—´å¯è§†åŒ– (Latent Space)

**ç”¨é€”ï¼ˆé‡è¦ï¼ï¼‰ï¼š**
1. **å±•ç¤ºèåˆæ•ˆæœ**ï¼šå¯¹æ¯”å•æ¨¡æ€vså¤šæ¨¡æ€è¡¨ç¤º
2. **å¯è§£é‡Šæ€§**ï¼šä¸åŒæ€§è´¨ææ–™æ˜¯å¦è¢«åˆ†å¼€
3. **ç‰¹å¾è´¨é‡**ï¼šèšç±»æ¸…æ™°åº¦åæ˜ ç‰¹å¾åˆ¤åˆ«åŠ›

**è®ºæ–‡ä¸­çš„äº®ç‚¹ï¼š**

#### å¯¹æ¯”å›¾ (Comparison Plot)
**æœ€é‡è¦çš„å›¾ï¼** å¹¶æ’å±•ç¤ºï¼š
- å·¦å›¾ï¼šä»…å›¾ç‰¹å¾ â†’ å¯èƒ½æ··æ‚
- ä¸­å›¾ï¼šä»…æ–‡æœ¬ç‰¹å¾ â†’ å¯èƒ½åˆ†ç¦»ä¸æ˜æ˜¾
- å³å›¾ï¼šèåˆç‰¹å¾ â†’ **èšç±»æ›´æ¸…æ™°ï¼Œåˆ†ç¦»æ›´å¥½**

**å†™ä½œç¤ºä¾‹ï¼š**
> "Figure X shows the latent space visualization using t-SNE. Compared to single-modality features (graph-only or text-only), the fused representations demonstrate superior separability, with materials of different band gap ranges forming distinct clusters. This indicates that cross-modal attention successfully integrates complementary information from both structure and text descriptions."

#### æŒ‰å±æ€§ç€è‰²çš„æ´å¯Ÿ
**å›å½’ä»»åŠ¡ï¼š**
- é¢œè‰²æ¸å˜è¿ç»­ â†’ æ¨¡å‹å­¦åˆ°äº†è¿ç»­çš„æ€§è´¨å˜åŒ–
- åŒè‰²åŒºåŸŸèšé›† â†’ ç›¸ä¼¼æ€§è´¨çš„ææ–™åœ¨ç‰¹å¾ç©ºé—´ç›¸è¿‘

**åˆ†ç±»ä»»åŠ¡ï¼š**
- ä¸åŒç±»åˆ«åˆ†ç¦»æ¸…æ¥š â†’ åˆ¤åˆ«ç‰¹å¾å­¦ä¹ æˆåŠŸ
- ç±»åˆ«è¾¹ç•Œæ˜æ˜¾ â†’ é«˜ç½®ä¿¡åº¦åˆ†ç±»

---

## ğŸ“ è®ºæ–‡å›¾è¡¨ç»„ç»‡å»ºè®®

### ä¸»æ–‡å›¾è¡¨ (Main Figures)

1. **Figure 1**: æ¨¡å‹æ¶æ„å›¾ï¼ˆæ‰‹ç»˜ï¼‰
2. **Figure 2**: è®­ç»ƒæ›²çº¿ï¼ˆç»¼åˆç‰ˆï¼‰
3. **Figure 3**: é¢„æµ‹ç»“æœå¯¹æ¯”ï¼ˆæµ‹è¯•é›†ï¼‰
4. **Figure 4**: æ½œåœ¨ç©ºé—´å¯¹æ¯”å›¾ï¼ˆGraph vs Text vs Fusedï¼‰âœ¨
5. **Figure 5**: ä¸Baselineæ–¹æ³•çš„æ€§èƒ½å¯¹æ¯”ï¼ˆéœ€æ‰‹åŠ¨åˆ¶ä½œï¼‰

### è¡¥å……ææ–™ (Supplementary)

1. **Figure S1**: è¯¦ç»†è®­ç»ƒæ›²çº¿ï¼ˆæ‰€æœ‰æŒ‡æ ‡ï¼‰
2. **Figure S2**: è®­ç»ƒ/éªŒè¯/æµ‹è¯•é›†é¢„æµ‹ç»“æœ
3. **Figure S3**: æ®‹å·®åˆ†ææˆ–ROCæ›²çº¿
4. **Figure S4**: 3Dæ½œåœ¨ç©ºé—´å¯è§†åŒ–
5. **Figure S5**: ä¸åŒè¶…å‚æ•°çš„æ½œåœ¨ç©ºé—´å¯¹æ¯”

---

## ğŸ”§ æ•…éšœæ’é™¤

### é—®é¢˜1: "æœªæ‰¾åˆ°history_*.json"
**è§£å†³ï¼š** ç¡®ä¿è®­ç»ƒæ—¶è®¾ç½®äº† `--store_outputs True`

### é—®é¢˜2: "æœªæ‰¾åˆ°predictions_*.csv"
**è§£å†³ï¼š** ç¡®ä¿è®­ç»ƒæ—¶è®¾ç½®äº† `--write_predictions True`

### é—®é¢˜3: UMAPæŠ¥é”™
**è§£å†³ï¼š** å®‰è£…UMAPï¼š`pip install umap-learn`ï¼Œæˆ–åªä½¿ç”¨t-SNE

### é—®é¢˜4: æ½œåœ¨ç©ºé—´å¯è§†åŒ–å¤ªæ…¢
**è§£å†³ï¼š** ä½¿ç”¨ `--max_samples 1000` é™åˆ¶æ ·æœ¬æ•°

### é—®é¢˜5: CUDAå†…å­˜ä¸è¶³
**è§£å†³ï¼š** ä½¿ç”¨ `--device cpu` æˆ–å‡å°‘ `--batch_size`

---

## ğŸ“¦ ä¾èµ–å®‰è£…

```bash
# åŸºç¡€ç»˜å›¾ï¼ˆå¿…éœ€ï¼‰
pip install matplotlib seaborn pandas numpy scikit-learn

# UMAPé™ç»´ï¼ˆå¯é€‰ï¼Œæ¨èï¼‰
pip install umap-learn

# å¦‚æœé‡åˆ°ä¾èµ–é—®é¢˜
pip install --upgrade matplotlib seaborn
```

---

## ğŸ’¡ é«˜çº§æŠ€å·§

### 1. æ‰¹é‡ç”Ÿæˆå¤šä¸ªå®éªŒçš„å›¾è¡¨

```bash
# å¾ªç¯å¤„ç†å¤šä¸ªè¾“å‡ºç›®å½•
for dir in output_*; do
    echo "å¤„ç†: $dir"
    ./generate_all_figures.sh "$dir" "figures/$dir"
done
```

### 2. è‡ªå®šä¹‰é¢œè‰²å’Œæ ·å¼

ç¼–è¾‘Pythonè„šæœ¬ä¸­çš„ä»¥ä¸‹éƒ¨åˆ†ï¼š
```python
# åœ¨ plot_*.py æ–‡ä»¶é¡¶éƒ¨ä¿®æ”¹
sns.set_style("whitegrid")  # æ”¹ä¸º "darkgrid", "white", "dark", "ticks"
plt.rcParams['font.size'] = 12  # è°ƒæ•´å­—ä½“å¤§å°
```

### 3. é«˜åˆ†è¾¨ç‡å›¾ç‰‡

æ‰€æœ‰è„šæœ¬é»˜è®¤ç”Ÿæˆ 300 DPI çš„å›¾ç‰‡ï¼Œå¦‚éœ€æ›´é«˜ï¼š
```python
plt.savefig(path, dpi=600, bbox_inches='tight')  # ä¿®æ”¹dpiå‚æ•°
```

---

## ğŸ“ å¼•ç”¨å’Œè‡´è°¢

å¦‚æœè¿™äº›å¯è§†åŒ–å·¥å…·å¯¹ä½ çš„ç ”ç©¶æœ‰å¸®åŠ©ï¼Œæ¬¢è¿å¼•ç”¨ç›¸å…³è®ºæ–‡å¹¶æ³¨æ˜å·¥å…·æ¥æºã€‚

**Happy Plotting! ğŸ¨ğŸ“Š**
